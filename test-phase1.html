<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 1 Features Test - Not a Label</title>
    <style>
        body {
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 20px;
            margin: 0;
        }
        
        .test-section {
            border: 1px solid #004400;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 68, 0, 0.1);
            border-radius: 5px;
        }
        
        .test-result {
            padding: 5px;
            margin: 5px 0;
            border-radius: 3px;
        }
        
        .success { background: rgba(0, 255, 0, 0.1); color: #00ff00; }
        .error { background: rgba(255, 68, 68, 0.1); color: #ff4444; }
        .warning { background: rgba(255, 170, 0, 0.1); color: #ffaa00; }
        .info { background: rgba(0, 255, 255, 0.1); color: #00ffff; }
        
        #test-output {
            background: #000;
            border: 1px solid #004400;
            padding: 15px;
            height: 500px;
            overflow-y: auto;
            font-size: 12px;
            border-radius: 5px;
        }
        
        button {
            background: #003300;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 12px 18px;
            margin: 8px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            border-radius: 5px;
            font-size: 14px;
        }
        
        button:hover {
            background: #004400;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: rgba(0, 68, 0, 0.05);
            border: 1px solid #004400;
            padding: 15px;
            border-radius: 5px;
        }
        
        .feature-status {
            float: right;
            font-weight: bold;
        }
        
        .commands-list {
            background: rgba(0, 34, 0, 0.3);
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            font-size: 11px;
        }
        
        h1, h2 { color: #00ff00; text-shadow: 0 0 10px rgba(0, 255, 0, 0.5); }
    </style>
</head>
<body>
    <h1>ğŸš€ Phase 1 Features Test Suite</h1>
    <p>Testing all Phase 1 enhancements: MIDI Integration, Audio-to-MIDI, Style Transfer, and Mobile Enhancements</p>
    
    <div class="test-section">
        <h2>ğŸ”§ System Status</h2>
        <div id="system-status">Initializing...</div>
        <div id="feature-overview" class="feature-grid"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ§ª Test Controls</h2>
        <button onclick="runAllTests()">ğŸ” Run All Tests</button>
        <button onclick="testMIDIIntegration()">ğŸ¹ Test MIDI</button>
        <button onclick="testAudioToMIDI()">ğŸ¤ Test Audio-to-MIDI</button>
        <button onclick="testStyleTransfer()">ğŸ¨ Test Style Transfer</button>
        <button onclick="testMobileEnhancements()">ğŸ“± Test Mobile</button>
        <button onclick="testIntegration()">ğŸ”— Test Integration</button>
        <button onclick="clearOutput()">ğŸ§¹ Clear Output</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“‹ Test Output</h2>
        <div id="test-output"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ’¡ Available Commands</h2>
        <div class="commands-list" id="commands-list">
            Loading command reference...
        </div>
    </div>

    <!-- Load all core systems first -->
    <script src="js/conversational-integrations.js"></script>
    <script src="js/memory-system.js"></script>
    <script src="js/voice-integration-system.js"></script>
    <script src="js/live-jam-sessions.js"></script>
    <script src="js/visual-nala-avatar.js"></script>
    <script src="js/integrated-command-bar.js"></script>
    <script src="js/smart-terminal.js"></script>
    
    <!-- Load advanced features -->
    <script src="js/advanced-workflows.js"></script>
    <script src="js/ai-intelligence.js"></script>
    <script src="js/music-creativity.js"></script>
    <script src="js/community-platform.js"></script>
    
    <!-- Load Phase 1 features -->
    <script src="js/midi-integration.js"></script>
    <script src="js/audio-to-midi.js"></script>
    <script src="js/style-transfer.js"></script>
    <script src="js/mobile-enhancements.js"></script>

    <script>
        let testOutput = document.getElementById('test-output');
        let systemStatus = document.getElementById('system-status');
        let featureOverview = document.getElementById('feature-overview');
        let commandsList = document.getElementById('commands-list');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toTimeString().split(' ')[0];
            const line = document.createElement('div');
            line.className = `test-result ${type}`;
            line.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            testOutput.appendChild(line);
            testOutput.scrollTop = testOutput.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function clearOutput() {
            testOutput.innerHTML = '';
        }
        
        // Mock addLine function for testing
        window.addLine = function(text, className = '') {
            log(`Terminal: ${text}`, 'info');
        };
        
        // Initialize all systems
        document.addEventListener('DOMContentLoaded', async () => {
            log('ğŸš€ Starting Phase 1 features test suite...', 'info');
            
            try {
                // Wait for systems to load
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const systems = [
                    { name: 'MIDI Integration', obj: 'midiIntegration', icon: 'ğŸ¹' },
                    { name: 'Audio-to-MIDI', obj: 'audioToMIDI', icon: 'ğŸ¤' },
                    { name: 'Style Transfer', obj: 'styleTransfer', icon: 'ğŸ¨' },
                    { name: 'Mobile Enhancements', obj: 'mobileEnhancements', icon: 'ğŸ“±' },
                    { name: 'Advanced Workflows', obj: 'advancedWorkflows', icon: 'ğŸ®' },
                    { name: 'AI Intelligence', obj: 'aiIntelligence', icon: 'ğŸ¤–' },
                    { name: 'Music Creativity', obj: 'musicCreativity', icon: 'ğŸµ' },
                    { name: 'Community Platform', obj: 'communityPlatform', icon: 'ğŸŒ' }
                ];
                
                let loadedSystems = 0;
                const systemCards = [];
                
                for (const system of systems) {
                    const isLoaded = window[system.obj];
                    const status = isLoaded ? 'Loaded' : 'Missing';
                    const statusClass = isLoaded ? 'success' : 'error';
                    
                    if (isLoaded) {
                        try {
                            await window[system.obj].initialize();
                            loadedSystems++;
                            log(`âœ… ${system.name} initialized successfully`, 'success');
                        } catch (error) {
                            log(`âš ï¸ ${system.name} initialization error: ${error.message}`, 'warning');
                        }
                    } else {
                        log(`âŒ ${system.name} not available`, 'error');
                    }
                    
                    systemCards.push(`
                        <div class="feature-card">
                            <h3>${system.icon} ${system.name}</h3>
                            <span class="feature-status ${statusClass}">${status}</span>
                            <div style="clear: both; margin-top: 10px;">
                                ${isLoaded ? getSystemCommands(system.obj) : 'System not available'}
                            </div>
                        </div>
                    `);
                }
                
                featureOverview.innerHTML = systemCards.join('');
                
                const statusText = `${loadedSystems}/${systems.length} systems loaded and initialized`;
                const statusClass = loadedSystems === systems.length ? 'success' : 'warning';
                systemStatus.innerHTML = `<span class="${statusClass}">${statusText}</span>`;
                
                // Update commands list
                updateCommandsList();
                
                log(`ğŸ¯ Initialization complete: ${statusText}`, loadedSystems === systems.length ? 'success' : 'warning');
                
            } catch (error) {
                log(`âŒ Initialization failed: ${error.message}`, 'error');
                systemStatus.innerHTML = '<span class="error">Initialization failed</span>';
            }
        });
        
        function getSystemCommands(systemName) {
            const commands = {
                'midiIntegration': ['midi devices', 'midi record', 'midi stop'],
                'audioToMIDI': ['hum to pattern', 'sing melody', 'audio start'],
                'styleTransfer': ['make it sound like daft punk', 'list styles'],
                'mobileEnhancements': ['Mobile controls active', 'Touch gestures enabled'],
                'advancedWorkflows': ['quickjam', 'flow', 'perform'],
                'aiIntelligence': ['Natural language AI ready'],
                'musicCreativity': ['create pattern', 'evolve genetic'],
                'communityPlatform': ['share pattern', 'start performance']
            };
            
            const systemCommands = commands[systemName] || ['System ready'];
            return systemCommands.map(cmd => `<code style="color: #00ffff;">${cmd}</code>`).join(', ');
        }
        
        function updateCommandsList() {
            const allCommands = [
                'ğŸ¹ <strong>MIDI Commands:</strong> midi devices, midi record, midi stop, midi settings',
                'ğŸ¤ <strong>Audio-to-MIDI:</strong> hum melody, sing pattern, audio start, audio stop',
                'ğŸ¨ <strong>Style Transfer:</strong> make [pattern] sound like [artist], list styles',
                'ğŸ“± <strong>Mobile:</strong> Touch gestures, virtual instruments, mobile controls',
                'ğŸ® <strong>Workflows:</strong> quickjam, flow, perform, learn',
                'ğŸ¤– <strong>AI:</strong> Natural language - "create jazzy beat", "make it energetic"',
                'ğŸµ <strong>Music:</strong> create pattern, evolve genetic, collaborate on',
                'ğŸŒ <strong>Community:</strong> share pattern, start performance, join challenge'
            ];
            
            commandsList.innerHTML = allCommands.join('<br>');
        }
        
        async function runAllTests() {
            log('ğŸ§ª Running comprehensive Phase 1 test suite...', 'info');
            clearOutput();
            
            await testMIDIIntegration();
            await testAudioToMIDI();
            await testStyleTransfer();
            await testMobileEnhancements();
            await testIntegration();
            
            log('âœ… All Phase 1 tests completed!', 'success');
        }
        
        async function testMIDIIntegration() {
            log('ğŸ¹ Testing MIDI Integration...', 'info');
            
            if (!window.midiIntegration) {
                log('âŒ MIDI Integration not available', 'error');
                return;
            }
            
            try {
                // Test device detection
                const devices = window.midiIntegration.getConnectedDevices();
                log(`ğŸ” Found ${devices.length} MIDI devices`, devices.length > 0 ? 'success' : 'info');
                
                // Test Web MIDI API support
                if (navigator.requestMIDIAccess) {
                    log('âœ… Web MIDI API supported', 'success');
                } else {
                    log('âš ï¸ Web MIDI API not supported in this browser', 'warning');
                }
                
                // Test recording functionality
                const recordingStatus = window.midiIntegration.getRecordingStatus();
                log(`ğŸµ MIDI recording system: ${recordingStatus.isRecording ? 'Active' : 'Ready'}`, 'info');
                
                // Test virtual note playing
                log('ğŸ¹ Testing virtual MIDI note...', 'info');
                window.midiIntegration.playVirtualNote(60, 100); // Middle C
                
                log('âœ… MIDI Integration tests passed', 'success');
                
            } catch (error) {
                log(`âŒ MIDI Integration test failed: ${error.message}`, 'error');
            }
        }
        
        async function testAudioToMIDI() {
            log('ğŸ¤ Testing Audio-to-MIDI Conversion...', 'info');
            
            if (!window.audioToMIDI) {
                log('âŒ Audio-to-MIDI not available', 'error');
                return;
            }
            
            try {
                // Test microphone access capability
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    log('âœ… Microphone access API available', 'success');
                } else {
                    log('âŒ Microphone access not supported', 'error');
                    return;
                }
                
                // Test conversion status
                const status = window.audioToMIDI.getConversionStatus();
                log(`ğŸµ Conversion status: ${status.isListening ? 'Listening' : 'Ready'}`, 'info');
                log(`ğŸ¯ Detected notes: ${status.notesDetected}`, 'info');
                log(`ğŸ¼ Key: ${status.currentKey} ${status.currentScale}`, 'info');
                
                // Test pitch detection capabilities
                const currentPitch = window.audioToMIDI.getCurrentPitch();
                log(`ğŸµ Pitch detection ready: ${currentPitch.note || 'No input'}`, 'info');
                
                // Test settings
                window.audioToMIDI.showSettings();
                
                log('âœ… Audio-to-MIDI tests passed', 'success');
                
            } catch (error) {
                log(`âŒ Audio-to-MIDI test failed: ${error.message}`, 'error');
            }
        }
        
        async function testStyleTransfer() {
            log('ğŸ¨ Testing Style Transfer System...', 'info');
            
            if (!window.styleTransfer) {
                log('âŒ Style Transfer not available', 'error');
                return;
            }
            
            try {
                // Test available styles
                const styles = window.styleTransfer.getAvailableStyles();
                log(`ğŸ¨ Available styles: ${styles.length} (${styles.join(', ')})`, 'success');
                
                // Test style characteristics
                styles.forEach(style => {
                    const characteristics = window.styleTransfer.getStyleCharacteristics(style);
                    if (characteristics) {
                        log(`ğŸµ ${style}: ${characteristics.rhythmic ? 'Rhythmic' : ''} ${characteristics.harmonic ? 'Harmonic' : ''} analysis ready`, 'info');
                    }
                });
                
                // Test transfer history
                const history = window.styleTransfer.getTransferHistory();
                log(`ğŸ“š Transfer history: ${history.length} previous transfers`, 'info');
                
                // Test style command parsing
                window.styleTransfer.showAvailableStyles();
                
                log('âœ… Style Transfer tests passed', 'success');
                
            } catch (error) {
                log(`âŒ Style Transfer test failed: ${error.message}`, 'error');
            }
        }
        
        async function testMobileEnhancements() {
            log('ğŸ“± Testing Mobile Enhancements...', 'info');
            
            if (!window.mobileEnhancements) {
                log('âŒ Mobile Enhancements not available', 'error');
                return;
            }
            
            try {
                // Test device detection
                const isMobile = window.mobileEnhancements.isMobileDevice();
                const isTablet = window.mobileEnhancements.isTabletDevice();
                const hasTouch = window.mobileEnhancements.hasTouchSupport();
                
                log(`ğŸ“± Device type: ${isMobile ? 'Mobile' : isTablet ? 'Tablet' : 'Desktop'}`, 'info');
                log(`ğŸ‘† Touch support: ${hasTouch ? 'Yes' : 'No'}`, hasTouch ? 'success' : 'info');
                
                // Test orientation
                const orientation = window.mobileEnhancements.getCurrentOrientation();
                log(`ğŸ”„ Orientation: ${orientation}Â° (${Math.abs(orientation) === 90 ? 'Landscape' : 'Portrait'})`, 'info');
                
                // Test mobile settings
                const settings = window.mobileEnhancements.getMobileSettings();
                log(`âš™ï¸ Touch sensitivity: ${Math.round(settings.touch_sensitivity * 100)}%`, 'info');
                log(`ğŸ¤š Gesture threshold: ${settings.gesture_threshold}px`, 'info');
                log(`ğŸ“³ Haptic feedback: ${settings.haptic_feedback ? 'Enabled' : 'Disabled'}`, 'info');
                
                // Test mobile-specific features
                if (isMobile || hasTouch) {
                    log('âœ… Mobile optimizations active', 'success');
                    log('ğŸ¹ Virtual instruments available', 'success');
                    log('ğŸ‘† Touch gestures enabled', 'success');
                } else {
                    log('â„¹ï¸ Desktop mode - mobile features in standby', 'info');
                }
                
                log('âœ… Mobile Enhancements tests passed', 'success');
                
            } catch (error) {
                log(`âŒ Mobile Enhancements test failed: ${error.message}`, 'error');
            }
        }
        
        async function testIntegration() {
            log('ğŸ”— Testing System Integration...', 'info');
            
            try {
                // Test cross-system integration
                const integrationTests = [
                    {
                        name: 'MIDI + Music Creativity',
                        test: () => window.midiIntegration && window.musicCreativity,
                        description: 'MIDI recording creates music patterns'
                    },
                    {
                        name: 'Audio-to-MIDI + Style Transfer',
                        test: () => window.audioToMIDI && window.styleTransfer,
                        description: 'Hummed melodies can be style-transferred'
                    },
                    {
                        name: 'Mobile + Voice Integration',
                        test: () => window.mobileEnhancements && window.voiceIntegrationSystem,
                        description: 'Mobile touch controls work with voice'
                    },
                    {
                        name: 'AI Intelligence + All Features',
                        test: () => window.aiIntelligence && window.midiIntegration && window.audioToMIDI && window.styleTransfer,
                        description: 'AI understands all new feature commands'
                    },
                    {
                        name: 'Smart Terminal + Phase 1',
                        test: () => window.smartTerminal && window.midiIntegration,
                        description: 'Terminal processes MIDI and audio commands'
                    }
                ];
                
                integrationTests.forEach(test => {
                    const passed = test.test();
                    log(`${passed ? 'âœ…' : 'âŒ'} ${test.name}: ${test.description}`, passed ? 'success' : 'warning');
                });
                
                // Test command processing integration
                if (window.smartTerminal && window.midiIntegration) {
                    log('ğŸ§ª Testing command integration...', 'info');
                    
                    // Simulate command processing
                    const testCommands = [
                        'midi devices',
                        'hum melody',
                        'make this sound like daft punk',
                        'mobile menu'
                    ];
                    
                    testCommands.forEach(command => {
                        log(`ğŸ“ Command test: "${command}" - routing ready`, 'info');
                    });
                }
                
                log('âœ… Integration tests passed', 'success');
                
            } catch (error) {
                log(`âŒ Integration test failed: ${error.message}`, 'error');
            }
        }
        
        // Add demo buttons for live testing
        function addDemoControls() {
            const demoSection = document.createElement('div');
            demoSection.className = 'test-section';
            demoSection.innerHTML = `
                <h2>ğŸ® Live Demo Controls</h2>
                <button onclick="demoMIDI()">ğŸ¹ Demo MIDI</button>
                <button onclick="demoAudio()">ğŸ¤ Demo Audio-to-MIDI</button>
                <button onclick="demoStyle()">ğŸ¨ Demo Style Transfer</button>
                <button onclick="demoMobile()">ğŸ“± Demo Mobile Features</button>
            `;
            document.body.appendChild(demoSection);
        }
        
        function demoMIDI() {
            if (window.midiIntegration) {
                log('ğŸ¹ Starting MIDI demo...', 'info');
                window.midiIntegration.showDeviceManager();
                
                // Play a demo note sequence
                const notes = [60, 64, 67, 72]; // C major chord
                notes.forEach((note, index) => {
                    setTimeout(() => {
                        window.midiIntegration.playVirtualNote(note, 100);
                        log(`ğŸµ Playing note: ${note}`, 'info');
                    }, index * 500);
                });
            }
        }
        
        function demoAudio() {
            if (window.audioToMIDI) {
                log('ğŸ¤ Audio-to-MIDI demo - speak or hum!', 'info');
                window.audioToMIDI.startConversion();
                
                setTimeout(() => {
                    window.audioToMIDI.stopConversion();
                    log('â¹ï¸ Audio demo stopped', 'info');
                }, 5000);
            }
        }
        
        function demoStyle() {
            if (window.styleTransfer) {
                log('ğŸ¨ Style Transfer demo', 'info');
                window.styleTransfer.showAvailableStyles();
                
                // Demo style analysis
                const styles = window.styleTransfer.getAvailableStyles();
                if (styles.length > 0) {
                    const characteristics = window.styleTransfer.getStyleCharacteristics(styles[0]);
                    log(`ğŸµ ${styles[0]} characteristics loaded`, 'success');
                }
            }
        }
        
        function demoMobile() {
            if (window.mobileEnhancements) {
                log('ğŸ“± Mobile features demo', 'info');
                
                if (window.mobileEnhancements.hasTouchSupport()) {
                    log('ğŸ‘† Touch interface active', 'success');
                    window.mobileEnhancements.showMobileMenu();
                } else {
                    log('ğŸ–±ï¸ Desktop mode - mobile features available but optimized for touch', 'info');
                }
            }
        }
        
        // Add demo controls after page loads
        setTimeout(addDemoControls, 3000);
    </script>
</body>
</html>